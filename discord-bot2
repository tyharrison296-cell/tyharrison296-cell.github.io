import discord
import aiohttp
import asyncio

TOKEN = ""
PLACE_ID = 2534724415
CHANNEL_ID = 1404148306124210207  # Replace with your channel ID
MESSAGE_ID = None  # Store message ID after first send

intents = discord.Intents.default()
client = discord.Client(intents=intents)

async def fetch_playercount():
    url = f"https://games.roblox.com/v1/games?universeIds={PLACE_ID}"
    async with aiohttp.ClientSession() as session:
        async with session.get(url) as resp:
            data = await resp.json()
            return data["data"][0]["playing"]

async def update_embed():
    global MESSAGE_ID
    channel = client.get_channel(CHANNEL_ID)

    while True:
        playercount = await fetch_playercount()

        embed = discord.Embed(
            title="New York City Roleplay | Live Status",
            description="Here is the live ER:LC server status",
            color=0x00ffcc
        )
        embed.add_field(name="Player Count", value=f"{playercount}/40")
        embed.set_footer(text="Auto-updates every 60s")

        if MESSAGE_ID is None:
            msg = await channel.send(embed=embed)
            MESSAGE_ID = msg.id
        else:
            msg = await channel.fetch_message(MESSAGE_ID)
            await msg.edit(embed=embed)

        await asyncio.sleep(60)

@client.event
async def on_ready():
    print(f"Logged in as {client.user}")
    client.loop.create_task(update_embed())

client.run(TOKEN)
